<h1>CareBridge Dashboard</h1>

@if (patientService.loading()) {
  <p>Loading clinical records from API...</p>
} @else if (patientService.error()) {
  <p style="color: #e11d48; font-weight: bold">
    ⚠️ Error: {{ patientService.error() }}. Please verify system connectivity.
  </p>
} @else {
  <p>
    Patients Overdue:
    <span style="font-weight: bold; color: #e11d48">{{ patientService.overdueCount() }}</span>
  </p>

  @if (patientService.overduePatients().length > 1) {
    <div style="margin: 1rem 0">
      <input
        #searchInput
        type="text"
        [value]="searchQuery()"
        (input)="updateSearch($event)"
        placeholder="Filter patients by name..."
        style="padding: 8px; width: 250px"
      />
    </div>
  }

  <ul>
    @for (p of filteredPatients(); track p.id) {
      <li
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;
        "
      >
        <span
          ><strong>{{ p.familyName }}</strong
          >, {{ p.givenName }}</span
        >
        <button
          (click)="patientService.markResolved(p.id)"
          style="margin-left: 10px; cursor: pointer"
        >
          Resolve
        </button>
      </li>
    } @empty {
      <li style="font-style: italic">
        {{ searchQuery() ? 'No patients match your search.' : 'No overdue patients found.' }}
      </li>
    }
  </ul>

  <div style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 15px">
    <button
      (click)="addNewPatient()"
      style="
        cursor: pointer;
        padding: 8px 16px;
        background: #2e3c64;
        color: white;
        border: none;
        border-radius: 4px;
      "
    >
      + Add Test Patient
    </button>
  </div>
}
